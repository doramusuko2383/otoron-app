<!DOCTYPE html>
<html lang="ja">
<head>
  <title>決済完了</title>
  <link rel="icon" href="/favicon.ico" />
</head>
<body style="margin:0;">
  <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;background-color:#fff;text-align:center;">
    <img src="../images/payment-success.webp" alt="絶対音感トレーニングアプリ『オトロン』決済完了を示す画像" style="max-width:80%;max-height:80vh;height:auto" />
    <p id="msg" style="margin-top:1rem;color:#666">決済が完了しました。反映には数秒〜数十秒かかる場合があります。</p>
    <div id="status" style="margin-top:0.5rem;color:#333"></div>
  </div>
  <script type="module">
    import { supabase } from '../utils/supabaseClient.js';

    const { data: { user } } = await supabase.auth.getUser();
    if (user) {
      const { data } = await supabase
        .from('user_subscriptions')
        .select('ended_at')
        .eq('user_id', user.id)
        .order('ended_at', { ascending: false })
        .limit(1)
        .maybeSingle();
      if (data?.ended_at) {
        document.getElementById('status').textContent =
          `現在の有効期限: ${new Date(data.ended_at).toLocaleString()}`;
      }
    }

    setTimeout(() => {
      window.location.href = '/#home';
    }, 3000);
  </script>
</body>
</html>
